<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Funeral Management System</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* DASHBOARD GRID STYLES */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .dash-card {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s;
            border-left: 6px solid #2c3e50;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .dash-card:hover { transform: translateY(-5px); border-left-color: #3498db; }
        .dash-card h3 { margin-top: 0; color: #2c3e50; font-size: 1.2rem; }
        .dash-card p { color: #7f8c8d; font-size: 0.9rem; margin-bottom: 0; }
        .nav-separator { color: white; padding: 0 10px; opacity: 0.5; }
        
        /* TABLE ACTION BUTTONS */
        .action-cell { display: flex; gap: 5px; }
        .danger-btn { background-color: #e74c3c; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px; }
        .print-btn { background-color: #3498db; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px; }
    </style>
</head>
<body>
    <div id="screen-content">

        <header>
            <h1>‚ö∞Ô∏è Funeral Management System</h1>
            <nav>
                <button onclick="showSection('dashboard')">Home</button>
                <div class="nav-separator">|</div>
                <button onclick="showSection('add-society')">Societies</button>
                <button onclick="showSection('contributions')">Payments</button>
                <div class="nav-separator">|</div>
                <button onclick="showSection('add-member')">New Member</button>
                <button onclick="showSection('funerals')">Arrangements</button>
                <button onclick="showSection('history')">History</button>
            </nav>
        </header>

        <main id="app">
            
            <!-- 1. DASHBOARD SECTION (UPDATED LABELS) -->
            <section id="dashboard" class="active-section">
                <h2>Dashboard Overview</h2>
                <div class="dashboard-grid">
                    
                    <!-- OPTION 1: Funeral Policy -->
                    <div class="dash-card" onclick="showSection('add-member')">
                        <h3>üìÑ Funeral Policy</h3>
                        <p>Register New Members & Assign Plans</p>
                    </div>

                    <!-- OPTION 2: Funeral Cover & Society -->
                    <div class="dash-card" onclick="showSection('add-society')">
                        <h3>üë• Funeral Cover & Society</h3>
                        <p>Manage Groups, Savings & Balances</p>
                    </div>

                    <!-- OPTION 3: Funeral Arrangements -->
                    <div class="dash-card" onclick="showSection('funerals')">
                        <h3>‚ö±Ô∏è Funeral Arrangements</h3>
                        <p>Logistics, Green Form & Claims</p>
                    </div>

                    <!-- OPTION 4: Payments (Kept for functionality) -->
                    <div class="dash-card" onclick="showSection('contributions')">
                        <h3>üí∞ Make Payment</h3>
                        <p>Record Premiums & Contributions</p>
                    </div>
                </div>
                
                <h3>Active Societies & Groups</h3>
                <div id="society-cards" class="card-container">
                    <p>Loading...</p>
                </div>
            </section>

            <!-- 2. ADD SOCIETY -->
            <section id="add-society" class="hidden-section">
                <h2>Create Funeral Cover / Society Group</h2>
                <form id="societyForm">
                    <label>Group / Society Name:</label>
                    <input type="text" id="societyName" required>
                    <label>Account Number:</label>
                    <input type="text" id="societyAccNo" placeholder="e.g. 76545" required>
                    <label>Initial Balance:</label>
                    <input type="number" id="societyBalance" value="0">
                    <button type="submit">Create Group</button>
                </form>
            </section>

            <!-- 3. SOCIETY DETAILS -->
            <section id="society-details" class="hidden-section">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <button class="back-btn" onclick="showSection('dashboard')">‚Üê Back to Dashboard</button>
                    <button class="action-btn" onclick="toggleEditSociety()">‚úèÔ∏è Edit Details</button>
                </div>

                <h2 id="detailTitle">Details</h2>

                <!-- Edit Form -->
                <div id="editSocietyContainer" style="display:none; background:#eee; padding:15px; border-radius:8px; margin-bottom:20px;">
                    <h3>Update Info</h3>
                    <form id="updateSocietyForm">
                        <input type="hidden" id="editSocietyId">
                        <label>Name:</label>
                        <input type="text" id="editSocietyName" required>
                        <label>Account Number:</label>
                        <input type="text" id="editSocietyAccNo" required>
                        <button type="submit">Save Changes</button>
                        <button type="button" class="danger-btn" onclick="toggleEditSociety()">Cancel</button>
                    </form>
                </div>
                
                <div class="table-wrapper">
                    <h3>üë• Members / Policy Holders</h3>
                    <table>
                        <thead>
                            <tr><th>ID</th><th>Name</th><th>Plan</th><th>Type</th><th>Status (Click to Toggle)</th><th>Action</th></tr>
                        </thead>
                        <tbody id="membersTableBody"></tbody>
                    </table>
                </div>

                <div class="table-wrapper">
                    <div class="header-row">
                        <h3>üí∞ Payment History</h3>
                        <div class="totals-display">Total: <span id="totalContributions">0.00</span></div>
                    </div>
                    <table>
                        <thead><tr><th>Date</th><th>Member</th><th>Amount</th><th>Method</th><th>Action</th></tr></thead>
                        <tbody id="contribTableBody"></tbody>
                    </table>
                </div>
            </section>

            <!-- 4. ADD MEMBER / POLICY -->
            <section id="add-member" class="hidden-section">
                <h2>Register New Funeral Policy / Member</h2>
                <form id="memberForm">
                    <label>First Name:</label>
                    <input type="text" id="memFirstName" required>
                    <label>Last Name:</label>
                    <input type="text" id="memLastName" required>
                    <label>ID Number:</label>
                    <input type="text" id="memIdNumber" required>

                    <label>Assign to Group/Society:</label>
                    <select id="memSocietySelect" required></select>

                    <!-- POLICY PLAN SELECTION -->
                    <label>Select Funeral Policy Plan:</label>
                    <select id="memPolicy">
                        <option value="None">None (Society Only)</option>
                        <option value="Plan A">Plan A (Essential - R10k)</option>
                        <option value="Plan B">Plan B (Essential - R20k)</option>
                        <option value="Plan C">Plan C (Essential - R30k)</option>
                        <option value="Plan D">Plan D (Essential - R40k)</option>
                        <option value="Bronze">Bronze (Group - R15k)</option>
                        <option value="Silver">Silver (Group - R20k)</option>
                        <option value="Gold">Gold (Group - R30k)</option>
                    </select>

                    <label>Member Type:</label>
                    <select id="memType" onchange="togglePrimaryMemberSelect()">
                        <option value="PRIMARY">Main Member</option>
                        <option value="BENEFICIARY">Beneficiary</option>
                    </select>

                    <div id="primaryMemberDiv" style="display:none;">
                        <label>Linked Main Member:</label>
                        <select id="linkedPrimaryMember"></select>
                    </div>

                    <button type="submit">Register</button>
                </form>
            </section>

            <!-- 5. PAY PREMIUMS -->
            <section id="contributions" class="hidden-section">
                <h2>Pay Premium / Contribution</h2>
                <form id="contributionForm">
                    <label>Select Member (Policy Holder):</label>
                    <select id="contribMemberSelect" required></select>
                    
                    <label>Amount:</label>
                    <input type="number" id="contribAmount" value="100.00" required>

                    <label>Payment Method:</label>
                    <select id="contribMethod">
                        <option value="Cash">Cash</option>
                        <option value="EFT">EFT / Bank Transfer</option>
                        <option value="Card">Card</option>
                    </select>
                    
                    <label>Notes (Month/Year):</label>
                    <input type="text" id="contribNotes" placeholder="e.g. Premium Jan 2025">

                    <button type="submit">Record Payment</button>
                </form>
            </section>

            <!-- 6. FUNERAL ARRANGEMENTS & CLAIMS -->
            <section id="funerals" class="hidden-section">
                <h2>Funeral Arrangements & Claims</h2>
                <div class="funeral-layout">
                    <div class="form-column">
                        <form id="funeralForm">
                            <div class="info-box" id="budgetDisplay">Society Balance: R 0.00</div>
                            <label>Select Deceased Member:</label>
                            <select id="funeralMemberSelect" onchange="updateFuneralFormDetails()" required></select>

                            <!-- GREEN FORM DATA -->
                            <fieldset style="border:1px solid #ccc; padding:10px; margin-bottom:10px;">
                                <legend>Bio Details</legend>
                                <div class="row">
                                    <input type="text" id="fBranch" placeholder="Branch Code" value="1000">
                                    <input type="text" id="fCountry" placeholder="Country" value="RSA">
                                </div>
                                <div class="row">
                                    <select id="fSex"><option value="Male">Male</option><option value="Female">Female</option></select>
                                    <select id="fMarital"><option value="Single">Single</option><option value="Married">Married</option></select>
                                </div>
                                <div class="row">
                                    <input type="date" id="fDob" title="Date of Birth">
                                    <input type="text" id="fOccupation" placeholder="Occupation">
                                </div>
                                <input type="text" id="fAddress" placeholder="Address">
                            </fieldset>

                            <fieldset style="border:1px solid #ccc; padding:10px; margin-bottom:10px;">
                                <legend>Death Info</legend>
                                <div class="row">
                                    <input type="date" id="fDateDeath" title="Date of Death">
                                    <input type="text" id="fPlaceDeath" placeholder="Place of Death">
                                </div>
                                <div class="row">
                                    <input type="text" id="fCause" placeholder="Cause">
                                    <input type="text" id="fDoctor" placeholder="Doctor">
                                </div>
                                <input type="text" id="fNextKin" placeholder="Next of Kin">
                            </fieldset>

                            <fieldset style="border:1px solid #ccc; padding:10px;">
                                <legend>Logistics</legend>
                                <div class="row">
                                    <input type="date" id="fDateBurial" title="Burial Date">
                                    <input type="time" id="fTimeBurial" title="Time">
                                </div>
                                <div class="row">
                                    <input type="text" id="fReligion" placeholder="Religion">
                                    <input type="text" id="fMinister" placeholder="Minister">
                                </div>
                                <div class="row">
                                    <input type="text" id="fCemetery" placeholder="Cemetery">
                                    <input type="text" id="fGraveNo" placeholder="Grave No">
                                </div>
                                <div class="row">
                                    <input type="text" id="fGraveType" placeholder="Grave Type">
                                    <label><input type="checkbox" id="fHearse"> Hearse</label>
                                    <label><input type="checkbox" id="fCar"> Car</label>
                                </div>
                            </fieldset>
                            <label>Instructions:</label>
                            <textarea id="fInstructions" rows="2"></textarea>
                        </form>
                    </div>

                    <!-- FINANCIALS / CLAIM -->
                    <div class="expense-column">
                        <h3>üí∞ Claim Calculation</h3>
                        <label>Policy Cover (Auto-filled):</label>
                        <input type="number" id="societyPays" placeholder="0.00">
                        
                        <h4>Expenses</h4>
                        <div class="row">
                            <input type="text" id="newItemName" placeholder="Item Name">
                            <input type="number" id="newItemCost" placeholder="Cost">
                            <button type="button" onclick="addExpenseItem()">Add</button>
                        </div>
                        <div class="table-wrapper">
                            <table class="expense-table">
                                <thead><tr><th>Item</th><th>Cost</th><th>X</th></tr></thead>
                                <tbody id="expenseListBody"></tbody>
                            </table>
                        </div>
                        <div class="total-row">Total Cost: <span id="displayTotalCost">R 0.00</span></div>
                        <button type="button" onclick="submitFuneral()" class="danger-btn" style="width:100%; margin-top:20px;">Process Claim</button>
                    </div>
                </div>
            </section>

            <!-- 7. HISTORY -->
            <section id="history" class="hidden-section">
                <h2>‚ö±Ô∏è Funeral History</h2>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Deceased</th>
                                <th>Society</th>
                                <th>Total Cost</th>
                                <th>Policy Paid</th>
                                <th>Family Paid</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="funeralHistoryBody"></tbody>
                    </table>
                </div>
            </section>

            <!-- EDIT MODAL -->
            <div id="editFuneralModal" class="modal-overlay" style="display:none;">
                <div class="modal-content">
                    <h3>Edit Funeral</h3>
                    <form id="editFuneralForm">
                        <input type="hidden" id="editFunId">
                        <div class="row">
                            <input type="text" id="efBranch" placeholder="Branch">
                            <input type="text" id="efCountry" placeholder="Country">
                        </div>
                        <div class="row">
                            <input type="text" id="efCemetery" placeholder="Cemetery">
                            <input type="text" id="efGraveNo" placeholder="Grave No">
                        </div>
                        <textarea id="efInstructions" rows="3" placeholder="Notes..."></textarea>
                        <div style="margin-top:15px; text-align:right;">
                            <button type="button" class="danger-btn" onclick="closeEditModal()">Cancel</button>
                            <button type="submit">Save</button>
                        </div>
                    </form>
                </div>
            </div>

        </main>
    </div>

    <!-- ============================================== -->
    <!--  PRINT TEMPLATE 1: PREMIUM RECEIPT             -->
    <!-- ============================================== -->
    <div id="receipt-print-area" class="print-area">
        <div class="receipt-box">
            <div class="receipt-header">
                <h2>Boikanyo's Funeral Home</h2>
                <h3>Payment Receipt</h3>
                <p><strong>FSP No: 3886</strong> | Reg: CK1997/031585/23</p>
                <p>1409 Zone 15 Industrial Site Lethabile | Tel: 012 251 0000</p>
            </div>
            <div class="receipt-grid">
                <div class="grid-box"><strong>Acc No:</strong> <span id="recAccNo"></span></div>
                <div class="grid-box"><strong>Receipt No:</strong> <span id="recNo"></span></div>
                <div class="grid-box"><strong>Date:</strong> <span id="recDate"></span></div>
                <div class="grid-box"><strong>Method:</strong> <span id="recMethod"></span></div>
                
                <div class="grid-box full-width"><strong>Received From:</strong> <span id="recMember"></span></div>
                
                <!-- DYNAMIC LABEL FOR PAYMENT TYPE -->
                <div class="grid-box full-width" style="background:#f9f9f9;">
                    <strong id="recPaymentLabel">Payment For:</strong> <span id="recPaymentContext"></span>
                </div>
                
                <div class="grid-box full-width" style="font-size:1.2em; padding:15px;">
                    <strong>Amount Paid:</strong> <span id="recAmount"></span>
                </div>
                
                <div class="grid-box full-width words-box"><span id="recWords"></span></div>
            </div>
            <div class="receipt-footer">
                <div class="balance-row"><strong>Current Balance:</strong> <div class="balance-box" id="recBalance"></div></div>
                <p style="text-align:center; font-size:0.8em; margin-top:10px;">Thank you for your payment.</p>
            </div>
        </div>
    </div>

    <!-- ============================================== -->
    <!--  PRINT TEMPLATE 2: FUNERAL INVOICE             -->
    <!-- ============================================== -->
    <div id="funeral-print-area" class="print-area">
        <div class="receipt-box">
            <div class="receipt-header">
                <h2>Boikanyo's Funeral Home</h2>
                <h3>Funeral Statement</h3>
                <p><strong>FSP: 3886</strong></p>
            </div>
            <div class="receipt-grid">
                <div class="grid-box"><strong>Date:</strong> <span id="funDate"></span></div>
                <div class="grid-box"><strong>Ref No:</strong> <span id="funRef"></span></div>
                <div class="grid-box full-width"><strong>Deceased:</strong> <span id="funDeceased"></span></div>
                <div class="grid-box"><strong>Society:</strong> <span id="funSociety"></span></div>
                <div class="grid-box"><strong>Grave:</strong> <span id="funGrave"></span></div>
                
                <div class="grid-box full-width" style="border:none; padding:0;">
                    <ul id="funExpenseList" style="list-style:none; padding:0; margin:10px 0; border-top:1px solid #333;"></ul>
                    <table style="width:100%; border-collapse:collapse; margin-top:10px;">
                        <tr><td style="padding:5px;">Total Cost</td><td style="text-align:right;" id="funTotal"></td></tr>
                        <tr><td style="padding:5px;">Less: Policy Cover</td><td style="text-align:right;" id="funSocPaid"></td></tr>
                        <tr style="font-size:1.2em; font-weight:bold; border-top:2px solid black;">
                            <td style="padding:5px;">FAMILY TO PAY</td><td style="text-align:right;" id="funFamilyPay"></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================== -->
    <!--  PRINT TEMPLATE 3: GREEN FORM (Comprehensive)  -->
    <!-- ============================================== -->
    <div id="green-form-print-area" class="print-area">
        <div class="green-form-box" style="font-family: Arial, sans-serif; border: 2px solid #000; padding: 20px; width: 800px; margin: auto;">
            <div class="green-header" style="text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 15px;">
                <h1 style="margin: 0;">BOIKANYO'S FUNERAL HOME</h1>
                <p style="margin: 5px 0;"><strong>FSP: 3886</strong></p>
                <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                    <span><strong>Date:</strong> <span id="gfDate"></span></span>
                    <span><strong>Ref No:</strong> <span id="gfId"></span></span>
                </div>
            </div>

            <!-- SECTION 1: BIO DETAILS -->
            <h4 style="margin: 10px 0 5px 0; background: #eee; padding: 5px;">I. BIO DETAILS</h4>
            <div class="green-grid" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; border: 1px solid #ccc; padding: 10px; font-size: 0.9em;">
                <div><strong>Surname:</strong> <span id="gfSurname"></span></div>
                <div><strong>First Names:</strong> <span id="gfFirstNames"></span></div>
                <div><strong>ID Number:</strong> <span id="gfIdNo"></span></div>
                
                <div><strong>Branch Code:</strong> <span id="gfBranch"></span></div>
                <div><strong>Country:</strong> <span id="gfCountry"></span></div>
                <div><strong>Sex:</strong> <span id="gfSex"></span></div>
                
                <div><strong>Marital Status:</strong> <span id="gfMarital"></span></div>
                <div><strong>Date of Birth:</strong> <span id="gfDob"></span></div>
                <div><strong>Occupation:</strong> <span id="gfOccupation"></span></div>
                
                <div style="grid-column: span 3;"><strong>Residential Address:</strong> <span id="gfAddress"></span></div>
            </div>

            <!-- SECTION 2: DEATH INFO -->
            <h4 style="margin: 15px 0 5px 0; background: #eee; padding: 5px;">II. DEATH INFO</h4>
            <div class="green-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; border: 1px solid #ccc; padding: 10px; font-size: 0.9em;">
                <div><strong>Date of Death:</strong> <span id="gfDOD"></span></div>
                <div><strong>Place of Death:</strong> <span id="gfPlaceDeath"></span></div>
                <div><strong>Cause of Death:</strong> <span id="gfCause"></span></div>
                <div><strong>Attending Doctor:</strong> <span id="gfDoctor"></span></div>
                <div style="grid-column: span 2;"><strong>Next of Kin:</strong> <span id="gfNextOfKin"></span></div>
            </div>

            <!-- SECTION 3: LOGISTICS -->
            <h4 style="margin: 15px 0 5px 0; background: #eee; padding: 5px;">III. FUNERAL LOGISTICS</h4>
            <div class="green-grid" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; border: 1px solid #ccc; padding: 10px; font-size: 0.9em;">
                <div><strong>Burial Date:</strong> <span id="gfBurialDate"></span></div>
                <div><strong>Time:</strong> <span id="gfTime"></span></div>
                <div><strong>Religion:</strong> <span id="gfReligion"></span></div>
                
                <div><strong>Minister:</strong> <span id="gfMinister"></span></div>
                <div><strong>Cemetery:</strong> <span id="gfCemetery"></span></div>
                <div><strong>Grave No:</strong> <span id="gfGrave"></span></div>
                
                <div><strong>Grave Type:</strong> <span id="gfGraveType"></span></div>
                <div><strong>Hearse:</strong> <span id="gfHearse"></span></div>
                <div><strong>Mourner's Car:</strong> <span id="gfCar"></span></div>
            </div>

            <!-- FINANCIAL SUMMARY -->
            <h4 style="margin: 15px 0 5px 0; background: #eee; padding: 5px;">IV. FINANCIAL SUMMARY</h4>
            <div style="border: 1px solid #000;">
                <table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">
                    <thead style="background: #f2f2f2;">
                        <tr><th style="text-align: left; padding: 5px; border-bottom: 1px solid #000;">Description</th><th style="text-align: right; padding: 5px; border-bottom: 1px solid #000;">Amount</th></tr>
                    </thead>
                    <tbody id="gfExpenseBody"></tbody>
                    <tfoot style="font-weight: bold;">
                        <tr><td style="text-align: right; padding: 5px;">Total Funeral Cost:</td><td style="text-align: right; padding: 5px;" id="gfTotal"></td></tr>
                        <tr><td style="text-align: right; padding: 5px;">Less Policy Cover/Society Paid:</td><td style="text-align: right; padding: 5px;" id="gfPaid"></td></tr>
                        <tr style="font-size: 1.1em; border-top: 2px solid #000;"><td style="text-align: right; padding: 5px;">BALANCE (Family to Pay):</td><td style="text-align: right; padding: 5px;" id="gfFamily"></td></tr>
                    </tfoot>
                </table>
            </div>

            <div style="margin-top: 15px; border: 1px solid #ccc; padding: 10px; font-size: 0.85em;">
                <strong>Special Instructions/Notes:</strong><br>
                <span id="gfNotes"></span>
            </div>

            <div style="margin-top: 40px; display: flex; justify-content: space-between; font-size: 0.8em;">
                <div style="border-top: 1px solid #000; width: 200px; text-align: center;">Family Representative Signature</div>
                <div style="border-top: 1px solid #000; width: 200px; text-align: center;">Authorized Official Signature</div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>