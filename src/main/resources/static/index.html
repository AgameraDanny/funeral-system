<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Funeral Management System</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="screen-content">

        <header>
            <h1>‚ö∞Ô∏è Funeral Management System</h1>
            <nav>
                <button onclick="showSection('dashboard')">Dashboard</button>
                <button onclick="showSection('add-society')">Add Society</button>
                <button onclick="showSection('add-member')">Add Member</button>
                <button onclick="showSection('contributions')">Contributions</button>
                <button onclick="showSection('funerals')">Record Funeral</button>
                <button onclick="showSection('history')">Funeral History</button>
            </nav>
        </header>

        <main id="app">
            
            <!-- DASHBOARD SECTION -->
            <section id="dashboard" class="active-section">
                <h2>Society Overview</h2>
                <div id="society-cards" class="card-container">
                    <!-- Society cards injected by JS -->
                    <p>Loading societies...</p>
                </div>
            </section>

            <!-- ADD SOCIETY -->
            <section id="add-society" class="hidden-section">
                <h2>Create New Society</h2>
                <form id="societyForm">
                    <label>Society Name:</label>
                    <input type="text" id="societyName" required>
                    
                    <!-- NEW FIELD -->
                    <label>Account Number:</label>
                    <input type="text" id="societyAccNo" placeholder="e.g. 76545" required>
                    
                    <label>Initial Balance:</label>
                    <input type="number" id="societyBalance" value="0">
                    <button type="submit">Create Society</button>
                </form>
            </section>

            <!-- SOCIETY DETAILS & EDIT -->
            <section id="society-details" class="hidden-section">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <button class="back-btn" onclick="showSection('dashboard')">‚Üê Back to Dashboard</button>
                    <!-- NEW EDIT BUTTON -->
                    <button class="action-btn" onclick="toggleEditSociety()">‚úèÔ∏è Edit Society Details</button>
                </div>

                <h2 id="detailTitle">Society Details</h2>
                
                <!-- NEW: EDIT FORM (Hidden by default) -->
                <div id="editSocietyContainer" style="display:none; background:#eee; padding:15px; border-radius:8px; margin-bottom:20px;">
                    <h3>Update Society Info</h3>
                    <form id="updateSocietyForm">
                        <input type="hidden" id="editSocietyId">
                        <label>Name:</label>
                        <input type="text" id="editSocietyName" required>
                        <label>Account Number:</label>
                        <input type="text" id="editSocietyAccNo" required>
                        <button type="submit">Save Changes</button>
                        <button type="button" class="danger-btn" onclick="toggleEditSociety()">Cancel</button>
                    </form>
                </div>

                <!-- Members Table -->
                <div class="table-wrapper">
                    <div class="header-row"><h3>üë• Members List</h3></div>
                    <table>
                        <thead>
                            <tr><th>ID</th><th>Name</th><th>Type</th><th>Linked To</th><th>Status</th></tr>
                        </thead>
                        <tbody id="membersTableBody"></tbody>
                    </table>
                </div>

                <!-- Contributions Table -->
                <div class="table-wrapper">
                    <div class="header-row">
                        <h3>üí∞ Contribution History</h3>
                        <div class="totals-display">Total: <span id="totalContributions">0.00</span></div>
                    </div>
                    <div class="filters">
                        Sort by: 
                        <button onclick="sortContributions('date')">Date</button>
                        <button onclick="sortContributions('name')">Name</button>
                        <button onclick="sortContributions('amount')">Amount</button>
                    </div>
                    <table>
                        <thead><tr><th>Date</th><th>Member</th><th>Amount</th><th>Notes</th><th>Action</th></tr></thead>
                        <tbody id="contribTableBody"></tbody>
                    </table>
                </div>
            </section>

            <!-- ADD MEMBER SECTION -->
            <section id="add-member" class="hidden-section">
                <h2>Register Member</h2>
                <form id="memberForm">
                    <label>First Name:</label>
                    <input type="text" id="memFirstName" required>
                    
                    <label>Last Name:</label>
                    <input type="text" id="memLastName" required>

                    <label>ID Number:</label>
                    <input type="text" id="memIdNumber" required>

                    <label>Society:</label>
                    <select id="memSocietySelect" required></select>

                    <label>Policy Plan:</label>
                    <select id="memPolicy">
                        <option value="None">None</option>
                        <option value="Plan A">Plan A (R10k Cover)</option>
                        <option value="Plan B">Plan B (R20k Cover)</option>
                        <option value="Plan C">Plan C (R30k Cover)</option>
                        <option value="Bronze">Bronze Scheme</option>
                        <option value="Silver">Silver Scheme</option>
                        <option value="Gold">Gold Scheme</option>
                    </select>

                    <label>Member Type:</label>
                    <select id="memType" onchange="togglePrimaryMemberSelect()">
                        <option value="PRIMARY">Primary Member</option>
                        <option value="BENEFICIARY">Beneficiary</option>
                    </select>

                    <div id="primaryMemberDiv" style="display:none;">
                        <label>Linked Primary Member:</label>
                        <select id="linkedPrimaryMember"></select>
                    </div>

                    <button type="submit">Register Member</button>
                </form>
            </section>

            <!-- CONTRIBUTIONS SECTION -->
            <section id="contributions" class="hidden-section">
                <h2>Record Monthly Contribution</h2>
                <form id="contributionForm">
                    <label>Select Member (Primary Only):</label>
                    <select id="contribMemberSelect" required></select>
                    
                    <label>Amount:</label>
                    <input type="number" id="contribAmount" value="100.00" required>

                    <label>Payment Method:</label>
                    <select id="contribMethod">
                        <option value="Cash">Cash</option>
                        <option value="EFT">EFT / Bank Transfer</option>
                        <option value="Card">Card</option>
                    </select>
                    
                    <label>Notes (Month/Year):</label>
                    <input type="text" id="contribNotes" placeholder="e.g. Jan 2025">

                    <button type="submit">Record Payment</button>
                </form>
            </section>

            <!-- FUNERALS SECTION -->
            <section id="funerals" class="hidden-section">
                <h2>Record Funeral (Boikanyo's Form)</h2>
                <div class="funeral-layout">
                    <div class="form-column">
                        <form id="funeralForm">
                            <div class="info-box" id="budgetDisplay">Society Balance: R 0.00</div>
                            <label>Select Deceased Member:</label>
                            <select id="funeralMemberSelect" onchange="updateSocietyBalanceDisplay()" required></select>

                            <!-- 1. DECEASED BIO DETAILS -->
                            <fieldset style="border:1px solid #ccc; padding:10px; margin-bottom:10px;">
                                <legend>Deceased Personal Details</legend>
                                <div class="row">
                                    <input type="text" id="fBranch" placeholder="Branch Code (e.g. 1000)" value="1000">
                                    <input type="text" id="fCountry" placeholder="Country of Birth" value="R.S.A">
                                </div>
                                <div class="row">
                                    <select id="fSex">
                                        <option value="">Select Sex</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                    </select>
                                    <select id="fMarital">
                                        <option value="Single">Single</option>
                                        <option value="Married">Married</option>
                                        <option value="Widowed">Widowed</option>
                                    </select>
                                </div>
                                <div class="row">
                                    <div class="input-group">
                                        <label style="font-size:12px">Date of Birth</label>
                                        <input type="date" id="fDob">
                                    </div>
                                    <input type="text" id="fOccupation" placeholder="Occupation">
                                </div>
                                <input type="text" id="fAddress" placeholder="Residential Address">
                            </fieldset>

                            <!-- 2. DEATH & MEDICAL DETAILS -->
                            <fieldset style="border:1px solid #ccc; padding:10px; margin-bottom:10px;">
                                <legend>Death Details</legend>
                                <div class="row">
                                    <div class="input-group">
                                        <label style="font-size:12px">Date of Death</label>
                                        <input type="date" id="fDateDeath">
                                    </div>
                                    <input type="text" id="fPlaceDeath" placeholder="Place of Death">
                                </div>
                                <div class="row">
                                    <input type="text" id="fCause" placeholder="Cause of Death">
                                    <input type="text" id="fDoctor" placeholder="Doctor Name">
                                </div>
                                <input type="text" id="fNextKin" placeholder="Next of Kin Full Name">
                            </fieldset>

                            <!-- 3. FUNERAL LOGISTICS -->
                            <fieldset style="border:1px solid #ccc; padding:10px;">
                                <legend>Funeral Arrangement</legend>
                                <div class="row">
                                    <div class="input-group">
                                        <label style="font-size:12px">Date of Burial</label>
                                        <input type="date" id="fDateBurial">
                                    </div>
                                    <div class="input-group">
                                        <label style="font-size:12px">Time</label>
                                        <input type="time" id="fTimeBurial">
                                    </div>
                                </div>
                                <div class="row">
                                    <input type="text" id="fReligion" placeholder="Religion">
                                    <input type="text" id="fMinister" placeholder="Minister">
                                </div>
                                <div class="row">
                                    <input type="text" id="fVenue" placeholder="Venue (Home/Church)">
                                    <input type="text" id="fPlaceBurial" placeholder="Place of Burial">
                                </div>
                                <div class="row">
                                    <input type="text" id="fCemetery" placeholder="Cemetery">
                                    <input type="text" id="fGraveNo" placeholder="Grave No">
                                </div>
                                <div class="row">
                                    <input type="text" id="fGraveType" placeholder="Grave Type (Ord/Deep)">
                                    <label style="display:flex; align-items:center; gap:5px;">
                                        <input type="checkbox" id="fHearse"> Hearse
                                    </label>
                                    <label style="display:flex; align-items:center; gap:5px;">
                                        <input type="checkbox" id="fCar"> Family Car
                                    </label>
                                </div>
                            </fieldset>

                            <label style="margin-top:10px;">Special Instructions (Tents/Bus/Etc):</label>
                            <textarea id="fInstructions" rows="3"></textarea>
                        </form>
                    </div>

                    <!-- Right Side: Expenses (Existing Code Structure) -->
                    <div class="expense-column">
                        <h3>üí∞ Financials</h3>
                        <label>Society Cover Amount (R):</label>
                        <input type="number" id="societyPays" placeholder="0.00">
                        
                        <h4>üìù Funeral Expenses</h4>
                        <div class="row">
                            <input type="text" id="newItemName" placeholder="Item Name">
                            <input type="number" id="newItemCost" placeholder="Cost">
                            <button type="button" onclick="addExpenseItem()">Add</button>
                        </div>
                        <div class="table-wrapper">
                            <table class="expense-table">
                                <thead><tr><th>Item</th><th>Cost</th><th>X</th></tr></thead>
                                <tbody id="expenseListBody"></tbody>
                            </table>
                        </div>
                        <div class="total-row">Total: <span id="displayTotalCost">R 0.00</span></div>
                        <button type="button" onclick="submitFuneral()" class="danger-btn" style="width:100%; margin-top:20px;">Process Funeral</button>
                    </div>
                </div>
            </section>

            <section id="society-details" class="hidden-section">
                <button class="back-btn" onclick="showSection('dashboard')">‚Üê Back to Dashboard</button>
                
                <h2 id="detailTitle">Society Details</h2>
                
                <!-- Members Table -->
                <div class="table-wrapper">
                    <div class="header-row">
                        <h3>üë• Members List</h3>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Linked To</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="membersTableBody">
                            <!-- Rows injected by JS -->
                        </tbody>
                    </table>
                </div>

                <!-- Contributions Table -->
                <div class="table-wrapper">
                    <div class="header-row">
                        <h3>üí∞ Contribution History</h3>
                        <div class="totals-display">Total: <span id="totalContributions">0.00</span></div>
                    </div>
                    
                    <!-- Sorting Controls -->
                    <div class="filters">
                        Sort by: 
                        <button onclick="sortContributions('date')">Date</button>
                        <button onclick="sortContributions('name')">Member Name</button>
                        <button onclick="sortContributions('amount')">Amount</button>
                    </div>

                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Member</th>
                                <th>Amount</th>
                                <th>Notes (Month/Year)</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="contribTableBody">
                            <!-- Rows injected by JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- FUNERAL HISTORY SECTION -->
            <section id="history" class="hidden-section">
                <h2>‚ö±Ô∏è Funeral History</h2>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Deceased</th>
                                <th>Society</th>
                                <th>Grave No</th>
                                <th>Total Cost</th>
                                <th>Soc. Paid</th> <!-- New -->
                                <th>Bal Before</th> <!-- New -->
                                <th>Bal After</th>  <!-- New -->
                                <th>Family Pays</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody id="funeralHistoryBody">
                            <!-- Rows injected by JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- EDIT FUNERAL MODAL (Hidden) -->
            <div id="editFuneralModal" class="modal-overlay" style="display:none;">
                <div class="modal-content">
                    <h3>Edit Funeral Details</h3>
                    <form id="editFuneralForm">
                        <input type="hidden" id="editFunId">
                        
                        <div class="row">
                            <input type="text" id="efBranch" placeholder="Branch">
                            <input type="text" id="efCountry" placeholder="Country">
                        </div>
                        <div class="row">
                            <input type="text" id="efOccupation" placeholder="Occupation">
                            <input type="text" id="efReligion" placeholder="Religion">
                        </div>
                        <div class="row">
                            <input type="text" id="efDoctor" placeholder="Doctor">
                            <input type="text" id="efCause" placeholder="Cause of Death">
                        </div>
                        <div class="row">
                            <input type="text" id="efPlaceDeath" placeholder="Place of Death">
                            <input type="text" id="efPlaceBurial" placeholder="Place of Burial">
                        </div>
                        <div class="row">
                            <input type="text" id="efCemetery" placeholder="Cemetery">
                            <input type="text" id="efGraveNo" placeholder="Grave No">
                        </div>
                        <div class="row">
                            <div class="input-group">
                                <label>Burial Date</label>
                                <input type="date" id="efDateBurial">
                            </div>
                            <div class="input-group">
                                <label>Time</label>
                                <input type="time" id="efTimeBurial">
                            </div>
                        </div>
                        <div class="row">
                            <label><input type="checkbox" id="efHearse"> Hearse</label>
                            <label><input type="checkbox" id="efCar"> Car</label>
                        </div>
                        
                        <textarea id="efInstructions" rows="3" placeholder="Notes..."></textarea>

                        <div style="margin-top:15px; text-align:right;">
                            <button type="button" class="danger-btn" onclick="closeEditModal()">Cancel</button>
                            <button type="submit">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>

        </main>

    </div>

    <!-- ============================================== -->
    <!--  1. SAVINGS RECEIPT TEMPLATE                   -->
    <!-- ============================================== -->
    <div id="receipt-print-area" class="print-area">
        <div class="receipt-box">
            <div class="receipt-header">
                <h2>Boikanyo's Funeral Home</h2>
                <h3>Society Savings Receipt</h3>
            </div>
            <div class="receipt-grid">
                <div class="grid-box"><strong>Acc No:</strong> <span id="recAccNo">---</span></div>
                <div class="grid-box"><strong>Receipt No:</strong> <span id="recNo">---</span></div>
                <div class="grid-box"><strong>Payment:</strong> <span id="recMethod">Cash</span></div>
                <div class="grid-box full-width"><strong>Date:</strong> <span id="recDate">---</span></div>
                <div class="grid-box full-width"><strong>Society:</strong> <span id="recSociety">---</span></div>
                <div class="grid-box full-width"><strong>Member:</strong> <span id="recMember">---</span></div>
                <div class="grid-box"><strong>Amt:</strong> <span id="recAmount">R 0.00</span></div>
                <div class="grid-box"><strong>Type:</strong> <span id="recType">Cash</span></div>
                <div class="grid-box full-width words-box"><span id="recWords">Zero Rands Only</span></div>
            </div>
            <div class="receipt-footer">
                <div class="balance-row"><strong>Acc Balance:</strong> <div class="balance-box" id="recBalance">R 0.00</div></div>
                <div class="company-details">
                    <p>Tel: 0122510000 | 1409 Zone 15 Industrial Site Lethabile</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================== -->
    <!--  2. FUNERAL INVOICE TEMPLATE                   -->
    <!-- ============================================== -->
    <div id="funeral-print-area" class="print-area">
        <div class="receipt-box">
            <div class="receipt-header">
                <h2>Boikanyo's Funeral Home</h2>
                <h3>Funeral Statement</h3>
            </div>
            <div class="receipt-grid">
                <div class="grid-box"><strong>Date:</strong> <span id="funDate">---</span></div>
                <div class="grid-box"><strong>Ref No:</strong> <span id="funRef">---</span></div>
                <div class="grid-box full-width"><strong>Deceased:</strong> <span id="funDeceased">---</span></div>
                <div class="grid-box"><strong>Society:</strong> <span id="funSociety">---</span></div>
                <div class="grid-box"><strong>Grave No:</strong> <span id="funGrave">---</span></div>
                
                <div class="grid-box full-width" style="border:none; padding:0;">
                    <table style="width:100%; margin-top:10px; border-collapse:collapse;">
                        <tr><td style="border:1px solid #000; padding:5px;">Total Cost</td><td style="border:1px solid #000; padding:5px; text-align:right;" id="funTotal">R 0.00</td></tr>
                        <tr><td style="border:1px solid #000; padding:5px;">Less: Society Paid</td><td style="border:1px solid #000; padding:5px; text-align:right;" id="funSocPaid">R 0.00</td></tr>
                        <tr><td style="border:1px solid #000; padding:5px; font-weight:bold;">FAMILY TO PAY</td><td style="border:1px solid #000; padding:5px; text-align:right; font-weight:bold;" id="funFamilyPay">R 0.00</td></tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================== -->
    <!--  3. GREEN FORM LOGISTICS TEMPLATE              -->
    <!-- ============================================== -->
    <div id="green-form-print-area" class="print-area">
        <div class="green-form-box">
            <div class="green-header">
                <h2>BOIKANYO'S FUNERAL HOME</h2>
                <div style="text-align:right;">
                    <span>Date: <span id="gfDate"></span></span><br>
                    <span>No: <span id="gfId"></span></span>
                </div>
            </div>

            <!-- BIO GRID -->
            <div class="green-grid" style="display:grid; grid-template-columns: 1fr 1fr; gap:5px; border:1px solid black; padding:5px;">
                <div><strong>Surname:</strong> <span id="gfSurname"></span></div>
                <div><strong>Names:</strong> <span id="gfFirstNames"></span></div>
                <div><strong>ID:</strong> <span id="gfIdNo"></span></div>
                <div><strong>Sex:</strong> <span id="gfSex"></span></div>
                <div><strong>Branch:</strong> <span id="gfBranch"></span></div>
                <div><strong>Address:</strong> <span id="gfAddress"></span></div>
                <div><strong>DOD:</strong> <span id="gfDOD"></span></div>
                <div><strong>Cause:</strong> <span id="gfCause"></span></div>
            </div>

            <!-- LOGISTICS GRID -->
            <div class="green-grid" style="margin-top:10px; border:1px solid black; padding:5px;">
                <div><strong>Burial Date:</strong> <span id="gfBurialDate"></span> <strong>Time:</strong> <span id="gfTime"></span></div>
                <div><strong>Cemetery:</strong> <span id="gfCemetery"></span> <strong>Grave:</strong> <span id="gfGrave"></span></div>
                <div><strong>Hearse:</strong> <span id="gfHearse"></span> <strong>Car:</strong> <span id="gfCar"></span></div>
            </div>

            <!-- FINANCIALS -->
            <div style="margin-top:10px; border:2px solid black;">
                <table style="width:100%; border-collapse:collapse;">
                    <thead><tr style="background:#eee;"><th style="text-align:left;">Item</th><th style="text-align:right;">Cost</th></tr></thead>
                    <tbody id="gfExpenseBody"></tbody>
                    <tfoot>
                        <tr><td style="text-align:right; font-weight:bold;">TOTAL:</td><td style="text-align:right;" id="gfTotal">0.00</td></tr>
                        <tr><td style="text-align:right;">Society:</td><td style="text-align:right;" id="gfPaid">0.00</td></tr>
                        <tr><td style="text-align:right; font-weight:bold;">BALANCE:</td><td style="text-align:right;" id="gfFamily">0.00</td></tr>
                    </tfoot>
                </table>
            </div>
            
            <div style="margin-top:10px; border:1px solid black; padding:5px;">
                <strong>Notes:</strong> <span id="gfNotes"></span>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>